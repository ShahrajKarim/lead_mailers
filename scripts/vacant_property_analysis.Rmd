---
title: "Leeds Vacant Property Analysis"
output: html_document
date: "2025-03-10"
---

```{r setup, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(readxl)
library(dplyr)
library(stringr)
library(ggplot2)
```

## Introduction

The list of residential addresses showed that we had 376k homes, but census data showed that there were 342k households.
This script aims to understand why there are 10% more homes than households in Leeds.

We investigate vacant properties at the LSOA level and find that this accounts for 50% of the difference between households and residential properties in Leeds.

## Load and clean data

```{r load-data, message=FALSE}
# Read vacant property data
vacant_property_data <- read_excel("raw_data/numberofvacantdwellingsandsecondhomes.xlsx", 
                                   sheet = "1c") %>%
  rename(
    lsoa21cd = 1,         
    lsoa_name = 2,         
    vacant_dwellings = 3,  
    second_home = 4        
  )

# Filter only LSOAs in Leeds
vacant_property_data <- vacant_property_data %>%
  filter(str_detect(lsoa_name, "Leeds"))

# Replace "c" (less than 10) with 0
vacant_property_data <- vacant_property_data %>%
  mutate(
    vacant_dwellings = ifelse(vacant_dwellings == "c", 0, vacant_dwellings),
    second_home = ifelse(second_home == "c", 0, second_home)
  )

# Calculate total vacant properties
vacant_property_data <- vacant_property_data %>%
  group_by(lsoa21cd, lsoa_name) %>%
  summarise(
    vacant_dwellings = sum(as.numeric(vacant_dwellings), na.rm = TRUE),
    second_home = sum(as.numeric(second_home), na.rm = TRUE),
    total_vacant = vacant_dwellings + second_home,
    .groups = "drop"
  )
```

## How many vacant properties are in Leeds?

```{r total-vacant}
# Calculate total number of vacant properties
total_vacant_properties <- sum(vacant_property_data$total_vacant, na.rm = TRUE)
print(total_vacant_properties)
```

The minimum number of vacant properties in Leeds is **`r format(total_vacant_properties, big.mark=",")`**, which explains about 50% of the discrepancy between households and homes.

## Compare with total properties in Leeds
```{r merge-property-data}
# Read full property dataset
property_data <- read.csv("processed_data/full_address_data.csv")

# Count number of properties per LSOA
lsoa_counts <- property_data %>%
  count(lsoa21cd, name = "property_count")

# Merge property count with vacant property data
vacant_property_data <- vacant_property_data %>%
  left_join(lsoa_counts, by = "lsoa21cd")

# Compute proportion of vacant properties per LSOA
vacant_property_data <- vacant_property_data %>%
  mutate(vacant_proportion = 100 * total_vacant / property_count)
```

## Distribution of vacant properties

The histogram below shows the distribution of vacant properties as a percentage of total properties across different LSOAs in Leeds.


```{r plot-vacancy, echo=FALSE}
ggplot(vacant_property_data, aes(x = vacant_proportion)) +  
  geom_histogram(binwidth = 1, fill = "blue", color = "black", alpha = 0.7) +  
  labs(title = "Distribution of Vacant Properties in Leeds by LSOA",
       x = "Proportion of Properties Vacant (%)",
       y = "Number of LSOAs") +
  theme_minimal()
```

## Key takeaways

- There are  **`r format(total_vacant_properties, big.mark=",")`** vacant properties in Leeds.
- This accounts for around 50% of the discrepancy between households and homes.
- The proportion of vacant properties varies across LSOAs, as shown in the histogram.

Note: This analysis underestimates the number of vacant properties, as LSOAs with 0 to 9 vacant properties are reported as ‘c’ (concealed). Since the exact values are unknown, we assume them to be 0.